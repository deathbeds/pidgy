(self.webpackChunk_jupyterlite_webrtc_docprovider=self.webpackChunk_jupyterlite_webrtc_docprovider||[]).push([[676,705],{676:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>u});var n=r(963),s=r.n(n);const{Int64BE:i}=r(449);function f(e,t){let r=0;for(const e of t)r+=e.length;const n=new e(r);let s=0;for(const e of t)n.set(e,s),s+=e.length;return n}class o extends(s()){constructor(e){super(e),this._opts=e,this._txOrdinal=0,this._rxPackets=[],this._txPause=!1,this.webRTCMessageQueue=[],this.webRTCPaused=!1}encodePacket({chunk:e,txOrd:t,index:r,length:n,totalSize:s,chunkSize:o}){return f(Uint8Array,[new Uint8Array(new i(t).toArrayBuffer()),new Uint8Array(new i(r).toArrayBuffer()),new Uint8Array(new i(n).toArrayBuffer()),new Uint8Array(new i(s).toArrayBuffer()),new Uint8Array(new i(o).toArrayBuffer()),e])}decodePacket(e){return{txOrd:new i(e.slice(0,8)).toNumber(),index:new i(e.slice(8,16)).toNumber(),length:new i(e.slice(16,24)).toNumber(),totalSize:new i(e.slice(24,32)).toNumber(),chunkSize:new i(e.slice(32,40)).toNumber(),chunk:e.slice(40)}}packetArray(e,t){const r=this._txOrdinal;this._txOrdinal++;const n=[],s=e.length||e.byteLength;let i=0;for(;i<s;)n.push(e.slice(i,t+i)),i+=t;return n.map(((e,t)=>this.encodePacket({chunk:e,txOrd:r,index:t,totalSize:s,length:n.length,chunkSize:e.byteLength})))}_onChannelMessage(e){const{data:t}=e,r=this.decodePacket(t);if(r.chunk instanceof ArrayBuffer&&(r.chunk=new Uint8Array(r.chunk)),r.chunkSize===r.totalSize)this.push(r.chunk);else{const e=this._rxPackets.filter((e=>e.txOrd===r.txOrd));e.push(r);const t=e.map((e=>e.index));if(new Set(t).size===r.length){e.sort(this.sortPacketArray);const t=f(Uint8Array,e.map((e=>e.chunk)));this.push(t),setTimeout((()=>{this._rxPackets=this._rxPackets.filter((e=>e.txOrd!==r.txOrd))}),3e4)}else this._rxPackets.push(r)}}sortPacketArray(e,t){return e.index>t.index?1:-1}send(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=this.packetArray(e,15872);this.webRTCMessageQueue=this.webRTCMessageQueue.concat(t),this.webRTCPaused||this.sendMessageQueued()}sendMessageQueued(){this.webRTCPaused=!1;let e=this.webRTCMessageQueue.shift();for(;e;){if(this._channel.bufferedAmount&&this._channel.bufferedAmount>65536){this.webRTCPaused=!0,this.webRTCMessageQueue.unshift(e);const t=()=>{this._channel.removeEventListener("bufferedamountlow",t),this.sendMessageQueued()};return void this._channel.addEventListener("bufferedamountlow",t)}try{super.send(e),e=this.webRTCMessageQueue.shift()}catch(e){super.destroy(),console.warn(e)}}}}const u=o},449:function(e,t){!function(e){var t,r="undefined",n=r!==typeof Buffer&&Buffer,s=r!==typeof Uint8Array&&Uint8Array,i=r!==typeof ArrayBuffer&&ArrayBuffer,f=[0,0,0,0,0,0,0,0],o=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},u=4294967296;function a(o,a,k){var v=a?0:4,x=a?4:0,_=a?0:3,m=a?1:2,B=a?2:1,P=a?3:0,C=a?w:A,M=a?p:g,S=T.prototype,U="is"+o,O="_"+U;return S.buffer=void 0,S.offset=0,S[O]=!0,S.toNumber=R,S.toString=function(e){var t=this.buffer,r=this.offset,n=Q(t,r+v),s=Q(t,r+x),i="",f=!k&&2147483648&n;for(f&&(n=~n,s=u-s),e=e||10;;){var o=n%e*u+s;if(n=Math.floor(n/e),s=Math.floor(o/e),i=(o%e).toString(e)+i,!n&&!s)break}return f&&(i="-"+i),i},S.toJSON=R,S.toArray=c,n&&(S.toBuffer=h),s&&(S.toArrayBuffer=l),T[U]=function(e){return!(!e||!e[O])},e[o]=T,T;function T(e,o,a,c){return this instanceof T?function(e,o,a,c,h){if(s&&i&&(o instanceof i&&(o=new s(o)),c instanceof i&&(c=new s(c))),o||a||c||t){if(!d(o,a)){var l=t||Array;h=a,c=o,a=0,o=t===n?n.alloc(8):new l(8)}e.buffer=o,e.offset=a|=0,r!==typeof c&&("string"==typeof c?function(e,t,r,n){var s=0,i=r.length,f=0,o=0;"-"===r[0]&&s++;for(var a=s;s<i;){var c=parseInt(r[s++],n);if(!(c>=0))break;o=o*n+c,f=f*n+Math.floor(o/u),o%=u}a&&(f=~f,o?o=u-o:f++),z(e,t+v,f),z(e,t+x,o)}(o,a,c,h||10):d(c,h)?y(o,a,c,h):"number"==typeof h?(z(o,a+v,c),z(o,a+x,h)):c>0?C(o,a,c):c<0?M(o,a,c):y(o,a,f,0))}else e.buffer=b(f,0)}(this,e,o,a,c):new T(e,o,a,c)}function R(){var e=this.buffer,t=this.offset,r=Q(e,t+v),n=Q(e,t+x);return k||(r|=0),r?r*u+n:n}function z(e,t,r){e[t+P]=255&r,r>>=8,e[t+B]=255&r,r>>=8,e[t+m]=255&r,r>>=8,e[t+_]=255&r}function Q(e,t){return 16777216*e[t+_]+(e[t+m]<<16)+(e[t+B]<<8)+e[t+P]}}function c(e){var r=this.buffer,n=this.offset;return t=null,!1!==e&&o(r)?8===r.length?r:r.slice(n,n+8):b(r,n)}function h(e){var r=this.buffer,s=this.offset;return t=n,!1!==e&&n.isBuffer(r)?8===r.length?r:r.slice(s,s+8):n.from(l.call(this,e))}function l(e){var r=this.buffer,n=this.offset,f=r.buffer;if(t=s,!1!==e&&!r.offset&&f instanceof i)return 8===f.byteLength?f:f.slice(n,n+8);var o=new s(8);return y(o,0,r,n),o.buffer}function d(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function y(e,t,r,n){t|=0,n|=0;for(var s=0;s<8;s++)e[t++]=255&r[n++]}function b(e,t){return Array.prototype.slice.call(e,t,t+8)}function w(e,t,r){for(var n=t+8;n>t;)e[--n]=255&r,r/=256}function p(e,t,r){var n=t+8;for(r++;n>t;)e[--n]=255&-r^255,r/=256}function A(e,t,r){for(var n=t+8;t<n;)e[t++]=255&r,r/=256}function g(e,t,r){var n=t+8;for(r++;t<n;)e[t++]=255&-r^255,r/=256}a("Uint64BE",!0,!0),a("Int64BE",!0,!1),a("Uint64LE",!1,!0),a("Int64LE",!1,!1)}("string"!=typeof t.nodeName?t:this||{})}}]);
//# sourceMappingURL=676.91dd2945fefd085c521d.js.map?v=91dd2945fefd085c521d