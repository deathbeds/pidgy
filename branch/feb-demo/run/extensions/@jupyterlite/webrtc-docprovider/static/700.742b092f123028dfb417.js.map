{"version":3,"file":"700.742b092f123028dfb417.js?v=742b092f123028dfb417","mappings":"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","sources":["webpack://@jupyterlite/webrtc-docprovider/./style/img/share-off.svg","webpack://@jupyterlite/webrtc-docprovider/./lib/icons.js","webpack://@jupyterlite/webrtc-docprovider/./style/img/webrtc.svg","webpack://@jupyterlite/webrtc-docprovider/./style/img/share.svg","webpack://@jupyterlite/webrtc-docprovider/./lib/manager.js","webpack://@jupyterlite/webrtc-docprovider/./lib/status.js","webpack://@jupyterlite/webrtc-docprovider/./lib/plugin.js","webpack://@jupyterlite/webrtc-docprovider/./lib/provider.js","webpack://@jupyterlite/webrtc-docprovider/./lib/tokens.js"],"sourcesContent":["export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" height=\\\"16px\\\" viewBox=\\\"0 0 24 24\\\" width=\\\"24px\\\" fill=\\\"#000000\\\">\\n  <path class=\\\"jp-icon0 jp-icon-selectable\\\" fill=\\\"#616161\\\" d=\\\"M21.22 18.02l2 2H24v-2h-2.78zm.77-2l.01-10c0-1.11-.9-2-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74zM2.39 1.73L1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10c0 1.1.89 2 2 2H0v2h18.13l2.71 2.71 1.27-1.27L2.39 1.73zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47z\\\" />\\n</svg>\\n\";","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport SHARE_OFF_SVG from '../style/img/share-off.svg';\nimport SHARE_SVG from '../style/img/share.svg';\nimport WEBRTC_SVG from '../style/img/webrtc.svg';\nexport const webrtcIcon = new LabIcon({\n    name: 'webrtc-docprovider:webrtc',\n    svgstr: WEBRTC_SVG,\n});\nexport const shareIcon = new LabIcon({\n    name: 'webrtc-docprovider:share',\n    svgstr: SHARE_SVG,\n});\nexport const shareOffIcon = new LabIcon({\n    name: 'webrtc-docprovider:share-off',\n    svgstr: SHARE_OFF_SVG,\n});\n//# sourceMappingURL=icons.js.map","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" height=\\\"134\\\" width=\\\"134\\\" viewBox=\\\"0 0 134 134\\\">\\n  <path fill=\\\"#f60\\\" d=\\\"M0 0c0-7.534-6.107-13.642-13.641-13.642-7.535 0-13.642 6.108-13.642 13.642s6.107 13.642 13.642 13.642C-6.107 13.642 0 7.534 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 74.323 101.632)\\\"/>\\n  <path fill=\\\"#fc0\\\" d=\\\"M0 0c0-7.533-6.107-13.642-13.641-13.642-7.535 0-13.642 6.109-13.642 13.642 0 7.534 6.107 13.643 13.642 13.643C-6.107 13.643 0 7.534 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 133.6 59.672)\\\"/>\\n  <path fill=\\\"#0089cc\\\" d=\\\"M0 0c0-7.533-6.107-13.642-13.642-13.642-7.533 0-13.641 6.109-13.641 13.642 0 7.534 6.108 13.643 13.641 13.643C-6.107 13.643 0 7.534 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 60.34 59.01)\\\"/>\\n  <path fill=\\\"#009939\\\" d=\\\"M0 0c0-7.534-6.107-13.642-13.643-13.642-7.533 0-13.641 6.108-13.641 13.642s6.108 13.642 13.641 13.642C-6.107 13.642 0 7.534 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 120.279 101.632)\\\"/>\\n  <path fill=\\\"#bf0000\\\" d=\\\"M0 0c0-7.534-6.108-13.642-13.642-13.642S-27.284-7.534-27.284 0s6.108 13.642 13.642 13.642S0 7.534 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 96.97 32.368)\\\"/>\\n  <path fill=\\\"#fc0007\\\" d=\\\"M0 0c0-.287.025-.568.043-.851C6.094.545 10.61 5.955 10.61 12.43c0 .287-.025.569-.043.852C4.516 11.885 0 6.475 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 73.66 59.672)\\\"/>\\n  <path fill=\\\"#1cd306\\\" d=\\\"M0 0c2.351-4.11 6.769-6.887 11.843-6.887 2.068 0 4.021.474 5.778 1.298-2.35 4.11-6.768 6.887-11.843 6.887C3.71 1.298 1.757.824 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 77.617 74.512)\\\"/>\\n  <path fill=\\\"#0f7504\\\" d=\\\"M0 0c0-3.333 1.198-6.383 3.184-8.752A13.583 13.583 0 0 1 6.366 0c0 3.333-1.198 6.383-3.182 8.752A13.574 13.574 0 0 1 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 60.34 101.632)\\\"/>\\n  <path fill=\\\"#0c5e87\\\" d=\\\"M0 0a13.578 13.578 0 0 1 5.401-1.117c5.024 0 9.401 2.723 11.769 6.766a13.581 13.581 0 0 1-5.401 1.116C6.745 6.765 2.367 4.042 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 18.502 86.525)\\\"/>\\n  <path fill=\\\"#6b0001\\\" d=\\\"M0 0c-.032-.38-.059-.762-.059-1.151 0-6.47 4.509-11.875 10.553-13.277.031.38.058.762.058 1.15C10.552-6.808 6.044-1.401 0 0\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 37.16 29.836)\\\"/>\\n  <path fill=\\\"#fff\\\" d=\\\"M0 0h-2.134A3.414 3.414 0 0 0-5.55 3.406v19.316a3.415 3.415 0 0 0 3.416 3.407h26.759a3.414 3.414 0 0 0 3.415-3.407V3.406A3.413 3.413 0 0 0 24.625 0h-9.116l-18.29-8.966z\\\" transform=\\\"matrix(2.19695 0 0 -2.19695 39.958 97.92)\\\"/>\\n</svg>\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" height=\\\"16px\\\" viewBox=\\\"0 0 24 24\\\" width=\\\"24px\\\" fill=\\\"#000000\\\">\\n    <path class=\\\"jp-icon-brand1 jp-icon-selectable\\\" fill=\\\"#616161\\\" d=\\\"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2h-4zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73-4 3.74z\\\" />\\n</svg>\\n\";","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { PageConfig } from '@jupyterlab/coreutils';\nimport { getAnonymousUserName, getRandomColor, ProviderMock, } from '@jupyterlab/docprovider';\nimport { UUID } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport { hash, codec } from 'sjcl';\nimport { WebRtcProvider } from './provider';\nimport { DEFAULT_SIGNALING_SERVERS, PageOptions, LOCAL_HOSTS, } from './tokens';\n/**\n * A configuragble WebRTC document provider factory\n *\n * This handles the preferred order of combining deployment information, settings,\n * and URL parameters to create and track providers.\n */\nexport class WebRtcManager {\n    constructor(options) {\n        /**\n         * Create a new document provider.\n         *\n         * This is the main purpose of this class.\n         */\n        this.createProvider = (options) => {\n            if (this.disabled) {\n                return new ProviderMock();\n            }\n            const rtcOptions = Object.assign(Object.assign({}, options), { room: this.fullRoomId, usercolor: this.usercolor, username: this.username, signalingUrls: this.signalingUrls });\n            const provider = new WebRtcProvider(rtcOptions);\n            provider.on('peers', (...args) => {\n                const { room } = provider;\n                if (!room) {\n                    return;\n                }\n                this.peerCount = room.webrtcConns.size + room.bcConns.size;\n            });\n            return provider;\n        };\n        this._stateChanged = new Signal(this);\n        this._peerCount = 0;\n        this._settings = options.settings || null;\n        if (this._settings) {\n            this._settings.changed.connect(() => this._stateChanged.emit(void 0));\n        }\n        this._urlParams = this.initUrlParams();\n        this._randomParams = this.initRandomParams();\n        this._trans = options.trans;\n    }\n    /**\n     * Parse known URL parameters.\n     */\n    initUrlParams() {\n        const params = new URLSearchParams(window.location.search);\n        // URL parameters that will overload settings\n        const room = (params.get('room') || '').trim() || null;\n        const username = (params.get('username') || '').trim() || null;\n        const usercolor = (params.get('usercolor') || '').trim() || null;\n        return { room, username, usercolor };\n    }\n    initRandomParams() {\n        return {\n            room: UUID.uuid4(),\n            usercolor: getRandomColor().slice(1),\n            username: getAnonymousUserName(),\n        };\n    }\n    get _composite() {\n        return this._settings ? this._settings.composite : {};\n    }\n    /**\n     * Whether the WebRTC is disabled.\n     *\n     * The order of preference is:\n     * - the server's `collaborative` setting\n     * - plugin settings\n     */\n    get disabled() {\n        const collaborative = PageConfig.getOption(PageOptions.collaborative) === 'true';\n        if (!collaborative) {\n            return true;\n        }\n        return !!this._composite.disabled;\n    }\n    /**\n     * The user's preferred name\n     *\n     * The order of preference is:\n     * - URL param\n     * - plugin settings\n     * - a random name, provided by JupyterLab core\n     */\n    get username() {\n        return (this._urlParams.username ||\n            this._composite.username ||\n            this._randomParams.username);\n    }\n    /**\n     * The user's preferred color.\n     *\n     * The order of preference is:\n     * - URL param\n     * - plugin settings\n     * - a random, themable color, provided by JupyterLab core\n     */\n    get usercolor() {\n        return (this._urlParams.usercolor ||\n            this._composite.usercolor ||\n            this._randomParams.usercolor);\n    }\n    /**\n     * The human-readable room name.\n     *\n     * The order of preference is:\n     * - URL param\n     * - plugin settings\n     * - a random UUID, not meant to be shared\n     */\n    get roomName() {\n        return this._urlParams.room || this._composite.room || this._randomParams.room;\n    }\n    /**\n     * Derive the obfuscated room id\n     *\n     * The order of preference is:\n     * - jupyter-config-data\n     * - plugin settings\n     * - the app's base URL\n     */\n    get fullRoomId() {\n        const { roomName } = this;\n        let roomPrefix = PageConfig.getOption(PageOptions.prefix) || this._composite.roomPrefix || null;\n        if (roomPrefix == null) {\n            const { hostname, origin } = window.location;\n            roomPrefix = LOCAL_HOSTS.includes(hostname.toLowerCase()) ? UUID.uuid4() : origin;\n        }\n        return codec.hex.fromBits(hash.sha256.hash(`${roomPrefix}-${roomName}`));\n    }\n    /**\n     * Get the signaling URLs\n     *\n     * The order of preference is:\n     * - jupyter-config-data\n     * - plugin settings\n     * - hard-coded defaults\n     */\n    get signalingUrls() {\n        let urls;\n        try {\n            urls = JSON.parse(PageConfig.getOption(PageOptions.urls));\n            if (urls && urls.length) {\n                return urls;\n            }\n        }\n        catch (_a) {\n            //\n        }\n        urls = this._composite.signalingUrls || null;\n        if (urls && urls.length) {\n            return urls;\n        }\n        console.warn(this._trans.__('Using default public WebRTC signaling servers: not recommended for production.'));\n        return DEFAULT_SIGNALING_SERVERS;\n    }\n    /**\n     * Get the last observed peer count.\n     */\n    get peerCount() {\n        return this._peerCount;\n    }\n    /**\n     * Set the last observed peer count.\n     */\n    set peerCount(peerCount) {\n        if (peerCount === this._peerCount) {\n            return;\n        }\n        this._peerCount = peerCount;\n        this._stateChanged.emit(void 0);\n    }\n    /**\n     * A signal that fires when the state of sharing and identity changes\n     */\n    get stateChanged() {\n        return this._stateChanged;\n    }\n    /**\n     * The translation bundle.\n     */\n    get trans() {\n        return this._trans;\n    }\n}\n//# sourceMappingURL=manager.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { VDomRenderer, VDomModel } from '@jupyterlab/apputils';\nimport React from 'react';\nimport { shareIcon, shareOffIcon } from './icons';\n/**\n * A statusbar indicator for WebRTC sharing\n */\nexport class WebRtcStatus extends VDomRenderer {\n    render() {\n        this.addClass('jp-WebRTCStatus');\n        const { manager } = this.model;\n        if (!manager) {\n            return React.createElement(React.Fragment, null);\n        }\n        const { username, disabled, roomName, usercolor, peerCount } = manager;\n        const icon = disabled ? shareOffIcon : shareIcon;\n        const userStyle = { textDecoration: 'underline', textDecorationColor: usercolor };\n        const title = disabled\n            ? manager.trans.__('Not Sharing')\n            : manager.trans.__('Sharing with %1 peers in %2 as %3', peerCount, roomName, username);\n        return disabled ? (React.createElement(\"div\", { title: title },\n            React.createElement(icon.react, { tag: \"span\" }))) : (React.createElement(\"div\", { title: title },\n            React.createElement(\"label\", null, peerCount),\n            React.createElement(icon.react, { tag: \"span\" }),\n            React.createElement(\"strong\", { style: userStyle }, roomName)));\n    }\n}\n/**\n * A namespace for WebRTC sharing status\n */\n(function (WebRtcStatus) {\n    class Model extends VDomModel {\n        constructor() {\n            super(...arguments);\n            this._manager = null;\n        }\n        get manager() {\n            return this._manager;\n        }\n        set manager(manager) {\n            var _a;\n            this._manager = manager;\n            this.stateChanged.emit(void 0);\n            (_a = this._manager) === null || _a === void 0 ? void 0 : _a.stateChanged.connect(() => this.stateChanged.emit(void 0));\n        }\n    }\n    WebRtcStatus.Model = Model;\n})(WebRtcStatus || (WebRtcStatus = {}));\n//# sourceMappingURL=status.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { ICommandPalette, Toolbar } from '@jupyterlab/apputils';\nimport { PageConfig } from '@jupyterlab/coreutils';\nimport { IDocumentProviderFactory } from '@jupyterlab/docprovider';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { IStatusBar } from '@jupyterlab/statusbar';\nimport { ITranslator, nullTranslator } from '@jupyterlab/translation';\nimport { DisposableDelegate } from '@lumino/disposable';\nimport { webrtcIcon } from './icons';\nimport { WebRtcManager } from './manager';\nimport { WebRtcStatus } from './status';\nimport { CommandIds, FACTORY_PLUGIN_ID, IWebRtcManager, NS, PLUGIN_ID, RETRO_EDIT_PAGE, RETRO_STATUS_PLUGIN_ID, STATUS_PLUGIN_ID, } from './tokens';\n/**\n * A WebRTC document provider plugin\n */\nconst plugin = {\n    id: PLUGIN_ID,\n    autoStart: true,\n    provides: IWebRtcManager,\n    optional: [ISettingRegistry, ITranslator, ICommandPalette],\n    activate: async (app, settingRegistry, translator, palette) => {\n        const options = {\n            trans: (translator || nullTranslator).load(NS),\n        };\n        if (settingRegistry) {\n            try {\n                options.settings = await settingRegistry.load(PLUGIN_ID);\n            }\n            catch (err) {\n                console.warn(options.trans.__('WebRTC Sharing Settings could not be loaded'), err);\n            }\n            const { settings } = options;\n            if (settings) {\n                const { commands } = app;\n                commands.addCommand(CommandIds.disable, {\n                    isToggleable: true,\n                    icon: webrtcIcon,\n                    label: options.trans.__('Toggle WebRTC Sharing'),\n                    isToggled: () => !settings.composite.disabled,\n                    execute: () => settings.set('disabled', !settings.composite.disabled),\n                });\n                if (palette) {\n                    palette.addItem({\n                        command: CommandIds.disable,\n                        category: options.trans.__('WebRTC Sharing'),\n                    });\n                }\n            }\n        }\n        const manager = new WebRtcManager(options);\n        return manager;\n    },\n};\nconst factoryPlugin = {\n    id: FACTORY_PLUGIN_ID,\n    autoStart: true,\n    provides: IDocumentProviderFactory,\n    requires: [IWebRtcManager],\n    activate: (app, manager) => {\n        return manager.createProvider;\n    },\n};\nconst statusPlugin = {\n    id: STATUS_PLUGIN_ID,\n    autoStart: true,\n    requires: [IWebRtcManager],\n    optional: [IStatusBar],\n    activate: (app, manager, status) => {\n        if (!status) {\n            return;\n        }\n        const model = new WebRtcStatus.Model();\n        model.manager = manager;\n        const item = new WebRtcStatus(model);\n        status.registerStatusItem(STATUS_PLUGIN_ID, { align: 'right', item });\n    },\n};\nconst retroStatusPlugin = {\n    id: RETRO_STATUS_PLUGIN_ID,\n    autoStart: true,\n    requires: [IWebRtcManager],\n    activate: (app, manager) => {\n        const retropage = PageConfig.getOption('retroPage');\n        if (!retropage) {\n            return;\n        }\n        const ext = {\n            createNew: (widget) => {\n                const toolbar = widget.toolbar;\n                if (!toolbar) {\n                    return;\n                }\n                const model = new WebRtcStatus.Model();\n                model.manager = manager;\n                const item = new WebRtcStatus(model);\n                if (retropage === RETRO_EDIT_PAGE) {\n                    const spacer = Toolbar.createSpacerItem();\n                    toolbar.addItem(`${RETRO_STATUS_PLUGIN_ID}-spacer`, spacer);\n                }\n                toolbar.addItem(RETRO_STATUS_PLUGIN_ID, item);\n                return new DisposableDelegate(() => item.dispose());\n            },\n        };\n        app.docRegistry.addWidgetExtension('Notebook', ext);\n        app.docRegistry.addWidgetExtension('Editor', ext);\n    },\n};\nexport default [plugin, statusPlugin, factoryPlugin, retroStatusPlugin];\n//# sourceMappingURL=plugin.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { Awareness } from 'y-protocols/awareness';\nimport { WebrtcProvider } from 'y-webrtc';\nimport { DEFAULT_SIGNALING_SERVERS } from './tokens';\n/**\n * A WebRTC-powered share document provider\n */\nexport class WebRtcProvider extends WebrtcProvider {\n    constructor(options) {\n        super(`${options.room}${options.path}`, options.ymodel.ydoc, WebRtcProvider.yProviderOptions(options));\n        this._initialRequest = null;\n        const { usercolor, username } = options;\n        this.awareness = options.ymodel.awareness;\n        const currState = this.awareness.getLocalState();\n        // only set if this was not already set by another plugin\n        if (currState && !currState.name) {\n            this.awareness.setLocalStateField('user', { name: username, color: usercolor });\n        }\n    }\n    setPath() {\n        // TODO: this seems super useful\n    }\n    requestInitialContent() {\n        if (this._initialRequest) {\n            return this._initialRequest.promise;\n        }\n        let resolved = false;\n        this._initialRequest = new PromiseDelegate();\n        this.on('synced', (event) => {\n            if (this._initialRequest) {\n                this._initialRequest.resolve(event.synced);\n                resolved = true;\n            }\n        });\n        // similar logic as in the upstream plugin\n        setTimeout(() => {\n            if (!resolved && this._initialRequest) {\n                this._initialRequest.resolve(false);\n            }\n        }, 1000);\n        return this._initialRequest.promise;\n    }\n    putInitializedState() {\n        // no-op\n    }\n    acquireLock() {\n        return Promise.resolve(0);\n    }\n    releaseLock(lock) {\n        // no-op\n    }\n}\n/**\n * A namespace for Yjs/WebRTC implementation details\n */\n(function (WebRtcProvider) {\n    /**\n     * Re-map Lab provider options to yjs ones.\n     */\n    function yProviderOptions(options) {\n        return {\n            signaling: options.signalingUrls && options.signalingUrls.length\n                ? options.signalingUrls\n                : DEFAULT_SIGNALING_SERVERS,\n            password: null,\n            awareness: new Awareness(options.ymodel.ydoc),\n            maxConns: 20 + Math.floor(Math.random() * 15),\n            filterBcConns: true,\n            peerOpts: {},\n        };\n    }\n    WebRtcProvider.yProviderOptions = yProviderOptions;\n})(WebRtcProvider || (WebRtcProvider = {}));\n//# sourceMappingURL=provider.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { Token } from '@lumino/coreutils';\n/**\n * The namespace for plugins, settings, and translations\n */\nexport const NS = '@jupyterlite/webrtc-docprovider';\n/**\n * The plugin id for registration and settings\n */\nexport const PLUGIN_ID = `${NS}:plugin`;\n/**\n * The plugin id for registration and settings\n */\nexport const FACTORY_PLUGIN_ID = `${NS}:factory`;\n/**\n * The plugin id for the status bar in full lab\n */\nexport const STATUS_PLUGIN_ID = `${NS}:status`;\n/**\n * The plugin id for the status bar in full lab\n */\nexport const RETRO_STATUS_PLUGIN_ID = `${NS}:retro-status`;\n/** The retro page for notebooks */\nexport const RETRO_NOTEBOOK_PAGE = 'notebooks';\n/** The retro page for text editors */\nexport const RETRO_EDIT_PAGE = 'edit';\n/**\n * Pages on which to add sharing status to the activity toolbar\n */\nexport const RETRO_STATUS_PAGES = [RETRO_NOTEBOOK_PAGE, RETRO_EDIT_PAGE];\n/**\n * Default Signaling Server URLs\n */\nexport const DEFAULT_SIGNALING_SERVERS = [\n    'wss://signaling.yjs.dev',\n    'wss://y-webrtc-signaling-eu.herokuapp.com',\n    'wss://y-webrtc-signaling-us.herokuapp.com',\n];\n/**\n * Domains for which random roomPrefixes should be used.\n */\nexport const LOCAL_HOSTS = ['127.0.0.1', 'localhost'];\n/**\n * JupyterLab command IDs\n */\nexport var CommandIds;\n(function (CommandIds) {\n    CommandIds.disable = 'webrtc-docprovider:disable';\n})(CommandIds || (CommandIds = {}));\n/**\n * constants of keys to provide to `jupyter-page-config`\n */\nexport var PageOptions;\n(function (PageOptions) {\n    PageOptions.urls = 'fullWebRtcSignalingUrls';\n    PageOptions.prefix = 'webRtcRoomPrefix';\n    PageOptions.collaborative = 'collaborative';\n})(PageOptions || (PageOptions = {}));\n/**\n * The token other plugins can use to refer to the WebRTC manager.\n */\nexport const IWebRtcManager = new Token(`${NS}:IWebRtcManager`);\n//# sourceMappingURL=tokens.js.map"],"names":["webrtcIcon","LabIcon","name","svgstr","shareIcon","shareOffIcon","WebRtcManager","constructor","options","this","createProvider","disabled","ProviderMock","rtcOptions","Object","assign","room","fullRoomId","usercolor","username","signalingUrls","provider","on","args","peerCount","webrtcConns","size","bcConns","_stateChanged","Signal","_peerCount","_settings","settings","changed","connect","emit","_urlParams","initUrlParams","_randomParams","initRandomParams","_trans","trans","params","URLSearchParams","window","location","search","get","trim","UUID","getRandomColor","slice","getAnonymousUserName","_composite","composite","PageConfig","roomName","roomPrefix","hostname","origin","toLowerCase","codec","hash","urls","JSON","parse","length","_a","console","warn","__","stateChanged","WebRtcStatus","VDomRenderer","render","addClass","manager","model","icon","userStyle","textDecoration","textDecorationColor","title","react","tag","style","Model","VDomModel","super","arguments","_manager","id","autoStart","provides","optional","ISettingRegistry","ITranslator","ICommandPalette","activate","async","app","settingRegistry","translator","palette","nullTranslator","load","NS","err","commands","addCommand","isToggleable","label","isToggled","execute","set","addItem","command","category","factoryPlugin","IDocumentProviderFactory","requires","IStatusBar","status","item","registerStatusItem","align","retropage","ext","createNew","widget","toolbar","spacer","Toolbar","DisposableDelegate","dispose","docRegistry","addWidgetExtension","WebRtcProvider","WebrtcProvider","path","ymodel","ydoc","yProviderOptions","_initialRequest","awareness","currState","getLocalState","setLocalStateField","color","setPath","requestInitialContent","promise","resolved","PromiseDelegate","event","resolve","synced","setTimeout","putInitializedState","acquireLock","Promise","releaseLock","lock","signaling","password","maxConns","Math","floor","random","filterBcConns","peerOpts","PLUGIN_ID","FACTORY_PLUGIN_ID","STATUS_PLUGIN_ID","RETRO_STATUS_PLUGIN_ID","RETRO_NOTEBOOK_PAGE","RETRO_EDIT_PAGE","RETRO_STATUS_PAGES","DEFAULT_SIGNALING_SERVERS","LOCAL_HOSTS","CommandIds","PageOptions","disable","prefix","collaborative","IWebRtcManager","Token"],"sourceRoot":""}